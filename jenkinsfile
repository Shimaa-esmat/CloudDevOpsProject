@Library('shared-library') _

pipeline {
    agent any

    environment {
        DOCKER_IMAGE = "shimaaesmat/gp-ivolve:latest"
        NAMESPACE = "ivolve"
    }

    stages {

        stage('Build Image') {
            steps {
                script { buildImage(DOCKER_IMAGE) }
            }
        }

        stage('Scan Image') {
            steps {
                script { scanImage(DOCKER_IMAGE) }
            }
        }

        stage('Push Image') {
            steps {
                script { pushImage(DOCKER_IMAGE) }
            }
        }

        stage('Delete Local Image') {
            steps {
                script { deleteImage(DOCKER_IMAGE) }
            }
        }

        stage('Update Manifests') {
            steps {
                script { updateManifest(DOCKER_IMAGE) }
            }
        }

        stage('Deploy to K8s') {
            steps {
                script { deployK8s(NAMESPACE) }
            }
        }
    }
}

